{
  "Threat Event (Unauthorized TOR Usage)": "Unauthorized TOR Browser Installation and Use",

  "Steps the 'Bad Actor' took to Create Logs and IoCs": [
    "Download the TOR browser installer: https://www.torproject.org/download/",
    "Install it silently: tor-browser-windows-x86_64-portable-14.0.1.exe /S",
    "Opens the TOR browser from the folder on the desktop",
    "Connect to TOR and browse a few sites.",
    "Current Dread Forum: g66ol3eb5ujdckzqqfmjsbpdjufmjd5nsgdipvxmsh7rckzlhywlzlqd.onion",
    "Dark Markets Forum: g66ol3eb5ujdckzqqfmjsbpdjufmjd5nsgdipvxmsh7rckzlhywlzlqd.onion/d/DarkNetMarkets",
    "Current Elysium Market: https://elysiumutkwscnmdohj23gkcyp3ebrf4iio3sngc5tvcgyfp4nqqmwad.top/login",
    "**Note:** It's possible the onion link for Dread Forum has changed. For latest links, check: https://dread-forum.com/",
    "Create a folder on your desktop called tor-shopping-list.txt and put a few fake (illicit) items in there",
    "Delete the file."
  ],

  "Tables Used to Detect IoCs": [
    {
      "Parameter": "Name",
      "Description": "DeviceFileEvents"
    },
    {
      "Parameter": "Info",
      "Description": "https://learn.microsoft.com/en-us/defender-xdr/advanced-hunting-deviceinfo-table"
    },
    {
      "Parameter": "Purpose",
      "Description": "Used for detecting TOR download and installation, as well as the shopping list creation and deletion."
    },
    {
      "Parameter": "Name",
      "Description": "DeviceProcessEvents"
    },
    {
      "Parameter": "Info",
      "Description": "https://learn.microsoft.com/en-us/defender-xdr/advanced-hunting-deviceinfo-table"
    },
    {
      "Parameter": "Purpose",
      "Description": "Used to detect the silent installation of TOR as well as the TOR browser and service launching."
    },
    {
      "Parameter": "Name",
      "Description": "DeviceNetworkEvents"
    },
    {
      "Parameter": "Info",
      "Description": "https://learn.microsoft.com/en-us/defender-xdr/advanced-hunting-devicenetworkevents-table"
    },
    {
      "Parameter": "Purpose",
      "Description": "Used to detect TOR network activity, specifically tor.exe and firefox.exe making connections over ports to be used by TOR (9001, 9030, 9040, 9050, 9051, 9150)."
    }
  ],

  "Related Queries": "```kql\n// Installer name == tor-browser-windows-x86_64-portable-(version).exe\n// Detect the installer being downloaded\nDeviceFileEvents\n| where FileName startswith \"tor\"\n\n// TOR Browser being silently installed\n// Take note of two spaces before the /S (I don't know why)\nDeviceProcessEvents\n| where ProcessCommandLine contains \"tor-browser-windows-x86_64-portable-14.0.1.exe  /S\"\n| project Timestamp, DeviceName, ActionType, FileName, ProcessCommandLine\n\n// TOR Browser or service was successfully installed and is present on the disk\nDeviceFileEvents\n| where FileName has_any (\"tor.exe\", \"firefox.exe\")\n| project  Timestamp, DeviceName, RequestAccountName, ActionType, InitiatingProcessCommandLine\n\n// TOR Browser or service was launched\nDeviceProcessEvents\n| where ProcessCommandLine has_any(\"tor.exe\",\"firefox.exe\")\n| project  Timestamp, DeviceName, AccountName, ActionType, ProcessCommandLine\n\n// TOR Browser or service is being used and is actively creating network connections\nDeviceNetworkEvents\n| where InitiatingProcessFileName in~ (\"tor.exe\", \"firefox.exe\")\n| where RemotePort in (9001, 9030, 9040, 9050, 9051, 9150)\n| project Timestamp, DeviceName, InitiatingProcessAccountName, InitiatingProcessFileName, RemoteIP, RemotePort, RemoteUrl\n| order by Timestamp desc\n\n// User shopping list was created and, changed, or deleted\nDeviceFileEvents\n| where FileName contains \"shopping-list.txt\"\n```",

  "Created By": {
    "Author Name": "Josh Madakor",
    "Author Contact": "https://www.linkedin.com/in/joshmadakor/",
    "Date": "August 31, 2024"
  },

  "Validated By": {
    "Reviewer Name": "",
    "Reviewer Contact": "",
    "Validation Date": ""
  },

  "Additional Notes": "None",

  "Revision History": [
    {
      "Version": "1.0",
      "Changes": "Initial draft",
      "Date": "September 6, 2024",
      "Modified By": "Josh Madakor"
    }
  ]
}
